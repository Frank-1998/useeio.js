!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).useeio={})}(this,(function(t){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},e(t,n)};function n(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}function r(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function a(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((r=r.apply(t,e||[])).next())}))}function i(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}var o=function(){function t(t){this.data=t,this.rows=t.length,this.cols=0===this.rows?0:t[0].length}return t.zeros=function(e,n){for(var r=new Array(e),i=0;i<e;i++){for(var o=new Array(n),s=0;s<n;s++)o[s]=0;r[i]=o}return new t(r)},t.prototype.get=function(t,e){return this.data[t][e]},t.prototype.getRow=function(t){return this.data[t].slice()},t.prototype.getCol=function(t){for(var e=new Array(this.rows),n=0;n<this.rows;n++)e[n]=this.get(n,t);return e},t.prototype.set=function(t,e,n){this.data[t][e]=n},t.prototype.scaleColumns=function(e){for(var n=t.zeros(this.rows,this.cols),r=0;r<this.rows;r++)for(var i=0;i<this.cols;i++){var o=this.get(r,i)*e[i];n.set(r,i,o)}return n},t.prototype.scaleRows=function(e){for(var n=t.zeros(this.rows,this.cols),r=0;r<this.rows;r++)for(var i=0;i<this.cols;i++){var o=this.get(r,i)*e[r];n.set(r,i,o)}return n},t.prototype.multiplyVector=function(t){return this.data.map((function(e){return e.reduce((function(e,n,r){var i=t[r];return n&&i?e+n*i:e}),0)}))},t}();function s(t){return new Array(t).fill(0)}var a,c=function(){function t(){}return t.directImpactsOf=function(t,e){return r(this,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:return n=e instanceof o?e.getCol(0):e,[4,t.matrix("D")];case 1:return[2,r.sent().multiplyVector(n)]}}))}))},t.directRequirementsOf=function(t,e){return r(this,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:return n=e instanceof o?e.getCol(0):e,[4,t.matrix("A")];case 1:return[2,r.sent().multiplyVector(n)]}}))}))},t.directDownstreamsOf=function(t,e){return r(this,void 0,void 0,(function(){var n,r,a,c,u,l,h,f;return i(this,(function(i){switch(i.label){case 0:return n=e instanceof o?e.getCol(0):e,[4,t.matrix("A")];case 1:for(r=i.sent(),a=Math.min(r.cols,n.length),c=s(a),u=0,l=r.data;u<l.length;u++)for(h=l[u],f=0;f<a;f++)c[f]+=h[f]*n[f];return[2,c]}}))}))},t}();t.IndicatorGroup=void 0,(a=t.IndicatorGroup||(t.IndicatorGroup={})).IMPACT_POTENTIAL="Impact Potential",a.RESOURCE_USE="Resource Use",a.WASTE_GENERATED="Waste Generated",a.ECONOMIC_SOCIAL="Economic & Social",a.CHEMICAL_RELEASES="Chemical Releases";var u,l=function(){function t(t){if(this.map={},t)for(var e=0,n=t;e<n.length;e++){var r=n[e];this.map[r.sector]=r.amount}}return t.prototype.get=function(t){var e=this.map[t];return e||0},t}();t.Region=void 0,(u=t.Region||(t.Region={})).DOMESTIC="DOMESTIC",u.NON_DOMESTIC="NON_DOMESTIC",u.ALL="ALL";var h=function(){function t(t){this._map=t}return t.of=function(e){var n;return r(this,void 0,void 0,(function(){var r,o,s,a,c,u,l,h,f,d,p,v,m,g,y;return i(this,(function(i){switch(i.label){case 0:return[4,e.sectorCrosswalk()];case 1:return(r=i.sent())&&r.header&&0!==r.header.length&&r.mappings&&0!==r.mappings.length?[4,e.info()]:[2,new t({})];case 2:for(o=i.sent(),s=null===(n=null==o?void 0:o.sectorschema)||void 0===n?void 0:n.toLowerCase(),a=-1,c=-1,u=0;u<r.header.length&&!(a>=0&&c>=0);u++)"naics"!==(l=r.header[u].toLowerCase())?(s&&l==s||!c&&l.includes("bea")&&l.includes("detail"))&&(c=u):a=u;if(a<0||c<0)return[2,new t({})];for(h={},f=Math.max(a,c)+1,d=0,p=r.mappings;d<p.length;d++)(v=p[d]).length<f||(m=v[a].trim(),g=v[c].trim(),0!=m.length&&0!=g.length&&((y=h[m])?y.push(g):h[m]=[g]));return[2,new t(h)]}}))}))},t.prototype.toBea=function(t){if(!t)return[];for(var e={},n=0,r=t instanceof Array?t:[t];n<r.length;n++){var i=r[n],o=this._map[i];if(o)for(var s=0,a=o;s<a.length;s++){e[a[s]]=!0}}return Object.keys(e)},t}();var f=function(){function t(t){if(this._config=t,!t||!t.endpoint)throw new Error("invalid endpoint");var e=t.endpoint;e.endsWith("/")||(e+="/"),this._endpoint=e}return t.prototype.isJsonDump=function(){return!0===this._config.asJsonFiles},t.prototype.getModelInfos=function(){return r(this,void 0,void 0,(function(){return i(this,(function(t){return[2,this.getJson("models")]}))}))},t.prototype.getJson=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return r(this,void 0,void 0,(function(){var e,n;return i(this,(function(r){return e=this._target.apply(this,t),this._config.asJsonFiles&&(e.endsWith(".json")||(e+=".json")),n=this._request("GET",e),[2,new Promise((function(t,r){n.onload=function(){if(200===n.status)try{var i=JSON.parse(n.responseText);t(i)}catch(t){r("failed to parse response for: "+e+": "+t)}else r("request ".concat(e," failed: ").concat(n.statusText))},n.send()}))]}))}))},t.prototype.getText=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return r(this,void 0,void 0,(function(){var e,n;return i(this,(function(r){return e=this._target.apply(this,t),n=this._request("GET",e),[2,new Promise((function(t,r){n.onload=function(){if(200===n.status)try{t(n.responseText)}catch(t){r("failed to parse response for: "+e+": "+t)}else r("request ".concat(e," failed: ").concat(n.statusText))},n.send()}))]}))}))},t.prototype.post=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return r(this,void 0,void 0,(function(){var n,r;return i(this,(function(i){return n=this._target.apply(this,e),r=this._request("POST",n),[2,new Promise((function(e,i){r.onload=function(){if(200===r.status)try{var t=JSON.parse(r.responseText);e(t)}catch(t){i("failed to parse response for POST "+n+": "+t)}else i("request POST ".concat(n," failed: ").concat(r.statusText))},r.send(JSON.stringify(t))}))]}))}))},t.prototype._target=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(!t)return this._endpoint;for(var n=this._endpoint,r=0,i=t;r<i.length;r++){var o=i[r];o&&(n.endsWith("/")||(n+="/"),n+=o)}return n},t.prototype._request=function(t,e){var n=new XMLHttpRequest;return n.open(t,e),n.setRequestHeader("Content-Type","application/json;charset=UTF-8"),this._config.apikey&&n.setRequestHeader("x-api-key",this._config.apikey),n},t}(),d=function(){function t(t,e){this.api=t,this.modelId=e,this._matrices={},this._demands={},this._totalResults={}}return t.prototype.id=function(){return this.modelId},t.prototype.info=function(){return r(this,void 0,void 0,(function(){var t,e,n,r;return i(this,(function(i){switch(i.label){case 0:return this._info?[3,2]:[4,this.api.getModelInfos()];case 1:for(t=i.sent(),e=0,n=t;e<n.length;e++)if((r=n[e]).id==this.id()){this._info=r;break}i.label=2;case 2:return[2,this._info]}}))}))},t.prototype.sectors=function(){return r(this,void 0,void 0,(function(){var t;return i(this,(function(e){switch(e.label){case 0:return this._sectors?[3,2]:(t=this,[4,this.api.getJson(this.modelId,"sectors")]);case 1:t._sectors=e.sent(),e.label=2;case 2:return[2,this._sectors||[]]}}))}))},t.prototype.isMultiRegional=function(){return r(this,void 0,void 0,(function(){var t,e,n,r,o;return i(this,(function(i){switch(i.label){case 0:return"boolean"==typeof this._isMultiRegional?[2,this._isMultiRegional]:[4,this.sectors()];case 1:for(t=i.sent(),n=0,r=t;n<r.length;n++)if((o=r[n]).location)if(e){if(e!==o.location)return this._isMultiRegional=!0,[2,!0]}else e=o.location;return this._isMultiRegional=!1,[2,!1]}}))}))},t.prototype.indicators=function(){return r(this,void 0,void 0,(function(){var t;return i(this,(function(e){switch(e.label){case 0:return this._indicators?[3,2]:(t=this,[4,this.api.getJson(this.modelId,"indicators")]);case 1:t._indicators=e.sent(),e.label=2;case 2:return[2,this._indicators||[]]}}))}))},t.prototype.demands=function(){return r(this,void 0,void 0,(function(){var t;return i(this,(function(e){switch(e.label){case 0:return this._demandInfos?[3,2]:(t=this,[4,this.api.getJson(this.modelId,"demands")]);case 1:t._demandInfos=e.sent(),e.label=2;case 2:return[2,this._demandInfos||[]]}}))}))},t.prototype.demand=function(t){return r(this,void 0,void 0,(function(){var e;return i(this,(function(n){switch(n.label){case 0:return(e=this._demands[t])?[2,e]:[4,this.api.getJson(this.modelId,"demands",t)];case 1:return e=n.sent(),this._demands[t]=e,[2,e]}}))}))},t.prototype.findDemand=function(t){return r(this,void 0,void 0,(function(){var e,n;return i(this,(function(r){switch(r.label){case 0:return[4,this.demands()];case 1:return e=r.sent(),[2,(n=e.find((function(e){return(!t.id||e.id===t.id)&&((!t.type||e.type===t.type)&&((!t.system||e.system===t.system)&&!(t.year&&e.year!==t.year)))})))?n.id:null]}}))}))},t.prototype.matrix=function(t){return r(this,void 0,void 0,(function(){var e,n;return i(this,(function(r){switch(r.label){case 0:return(e=this._matrices[t])?[2,e]:[4,this.api.getJson(this.modelId,"matrix",t)];case 1:return n=r.sent(),e=new o(n),this._matrices[t]=e,[2,e]}}))}))},t.prototype.column=function(t,e){return r(this,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:return(n=this._matrices[t])?[2,n.getCol(e)]:this.api.isJsonDump()?[4,this.matrix(t)]:[2,this.api.getJson(this.modelId,"matrix","".concat(t,"?col=").concat(e))];case 1:return[2,(n=r.sent()).getCol(e)]}}))}))},t.prototype.row=function(t,e){return r(this,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:return(n=this._matrices[t])?[2,n.getRow(e)]:this.api.isJsonDump()?[4,this.matrix(t)]:[2,this.api.getJson(this.modelId,"matrix","".concat(t,"?row=").concat(e))];case 1:return[2,(n=r.sent()).getRow(e)]}}))}))},t.prototype.calculate=function(t){return r(this,void 0,void 0,(function(){var e,n,r,o,s,a,c,u,l;return i(this,(function(i){switch(i.label){case 0:return this.api.isJsonDump()?[4,this.indicators()]:[2,this.api.post(t,this.modelId,"calculate")];case 1:return e=i.sent(),[4,this.sectors()];case 2:return n=i.sent(),r=new Array(n.length).fill(10),o={},n.reduce((function(t,e){return t[e.id]=e.index,t}),o),t.demand.forEach((function(t){var e=o[t.sector];(0===e||e)&&(r[e]=t.amount)})),[4,this.matrix("N")];case 3:switch(s=i.sent(),t.perspective){case"direct":return[3,4];case"intermediate":return[3,7];case"final":return[3,9]}return[3,10];case 4:case 7:return[4,this.matrix("L")];case 5:return c=i.sent(),l=c.multiplyVector(r),[4,this.matrix("D")];case 6:return u=i.sent(),a=u.scaleColumns(l).data,[3,11];case 8:return c=i.sent(),l=c.multiplyVector(r),a=s.scaleColumns(l).data,[3,11];case 9:return a=s.scaleColumns(r).data,[3,11];case 10:throw new Error("unknown perspective ".concat(t.perspective));case 11:return[2,{data:a,indicators:e.map((function(t){return t.code})),sectors:n.map((function(t){return t.id})),totals:s.multiplyVector(r)}]}}))}))},t.prototype.getTotalResults=function(t){return r(this,void 0,void 0,(function(){var e,n,r,o;return i(this,(function(i){switch(i.label){case 0:return Array.isArray(t)?(e={perspective:"final",demand:t},[4,this.calculate(e)]):[3,2];case 1:return[2,i.sent().totals];case 2:return(n=this._totalResults[t])&&n.length>0?[2,n]:[4,this.demand(t)];case 3:return r=i.sent(),[4,this.calculate({perspective:"final",demand:r})];case 4:return(o=i.sent())?(this._totalResults[t]=o.totals,[2,o.totals]):[2,[]]}}))}))},t.prototype.singleRegionSectors=function(){return r(this,void 0,void 0,(function(){var t,e,n,r,o,s,a,c;return i(this,(function(i){switch(i.label){case 0:return this._sectorAggregation?[2,this._sectorAggregation]:[4,this.sectors()];case 1:return t=i.sent(),[4,this.isMultiRegional()];case 2:if(!i.sent())return e=t.reduce((function(t,e){return t[e.code]=e.index,t}),{}),this._sectorAggregation={index:e,sectors:t},[2,this._sectorAggregation];for(n=[],r={},o=0,s=0,a=t;s<a.length;s++)c=a[s],void 0===r[c.code]&&(r[c.code]=o,n[o]={code:c.code,id:c.code,index:o,name:c.name,description:c.description},o++);return this._sectorAggregation={index:r,sectors:n},[2,this._sectorAggregation]}}))}))},t.prototype.sectorCrosswalk=function(){return r(this,void 0,void 0,(function(){var t,e,n,r,o,s;return i(this,(function(i){switch(i.label){case 0:return this._sectorCrosswalk?[2,this._sectorCrosswalk]:[4,this.api.getText("sectorcrosswalk.csv")];case 1:if(t=i.sent(),0==(e=t.split(/\r?\n/)).length)return[2,{header:[],mappings:[]}];for(n=function(t){var e=t.trim(),n=[];if(0==e.length)return n;for(var r=!1,i="",o=0;o<e.length;o++){var s=e.charAt(o);r?'"'==s?r=!1:i+=s:'"'!=s?","!=s?i+=s:(n.push(i),i=""):r=!0}return n.push(i),n},r=n(e[0]),o=[],s=1;s<e.length;s++)o.push(n(e[s]));return this._sectorCrosswalk={header:r,mappings:o},[2,this._sectorCrosswalk]}}))}))},t}(),p=function(){function t(t,e,n){this.model=t,this.sector=e,this.normalizationTotals=n}return t.of=function(e,n,o){return r(this,void 0,void 0,(function(){var r,s;return i(this,(function(i){switch(i.label){case 0:return[4,e.demand(o)];case 1:return r=i.sent(),[4,e.calculate({perspective:"direct",demand:r})];case 2:return s=i.sent(),[2,new t(e,n,s.totals)]}}))}))},t.prototype.getEnvironmentalProfile=function(t){return void 0===t&&(t=!1),r(this,void 0,void 0,(function(){var e,n;return i(this,(function(r){switch(r.label){case 0:return[4,t?this.model.column("D",this.sector.index):this.model.column("N",this.sector.index)];case 1:for(e=r.sent(),n=0;n<e.length;n++)e[n]/=this.normalizationTotals[n];return[2,e]}}))}))},t.prototype.getImpactsByScope=function(){return r(this,void 0,void 0,(function(){var t,e,n,r,o,a,c;return i(this,(function(i){switch(i.label){case 0:return[4,this.model.column("N",this.sector.index)];case 1:return t=i.sent(),[4,this.model.column("D",this.sector.index)];case 2:return e=i.sent(),[4,this.model.column("N_d",this.sector.index)];case 3:for(n=i.sent(),r=s(t.length),o=s(t.length),a=s(t.length),c=0;c<t.length;c++)r[c]=t[c]-e[c],o[c]=n[c]-e[c],a[c]=r[c]-o[c];return[2,{direct:e,total:t,upstreamTotal:r,upstreamDomestic:o,upstreamNonDomestic:a}]}}))}))},t.prototype.getPurchaseImpacts=function(t){return r(this,void 0,void 0,(function(){var e,n,r,o,a,c,u,l,h;return i(this,(function(i){switch(i.label){case 0:return[4,this.model.column("A",this.sector.index)];case 1:return e=i.sent(),Array.isArray(t)?[3,3]:[4,this.model.row("N",t.index)];case 2:return[2,i.sent().map((function(t,n){return t*e[n]}))];case 3:return n=s(e.length),[4,this.model.matrix("N")];case 4:for(r=i.sent(),o=0;o<e.length;o++){for(a=new m(this.normalizationTotals),c=e[o],u=0,l=t;u<l.length;u++)h=l[u],a.add(h.index,c*r.get(h.index,o));n[o]=a.finish()}return[2,n]}}))}))},t}(),v=function(t){this.totals=t,this.value=0};!function(t){function e(){return null!==t&&t.apply(this,arguments)||this}n(e,t),e.prototype.add=function(t,e){if(0!==e){var n=this.totals[t];0!==n&&(this.value+=e/n)}},e.prototype.finish=function(){return this.value}}(v);var m=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.add=function(t,e){if(0!==e){var n=this.totals[t];if(0!==n){var r=Math.pow(e/n,2);e>0?this.value+=r:this.value-=r}}},e.prototype.finish=function(){return this.value>0?Math.sqrt(this.value):0},e}(v);t.CommodityVector=c,t.DemandVector=l,t.Matrix=o,t.NaicsMap=h,t.SectorAnalysis=p,t.WebApi=f,t.WebModel=d,t.max=function(t){return t&&0!==t.length?t.reduce((function(t,e){return Math.max(t,e)})):0},t.modelOf=function(t){var e=new f(t);return new d(e,t.model)},t.ones=function(t){return new Array(t).fill(1)},t.zeros=s,Object.defineProperty(t,"__esModule",{value:!0})}));