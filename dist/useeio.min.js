!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).useeio={})}(this,(function(t){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */function e(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function a(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((r=r.apply(t,e||[])).next())}))}function n(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}var r=function(){function t(t){this.data=t,this.rows=t.length,this.cols=0===this.rows?0:t[0].length}return t.zeros=function(e,n){for(var r=new Array(e),i=0;i<e;i++){for(var o=new Array(n),s=0;s<n;s++)o[s]=0;r[i]=o}return new t(r)},t.prototype.get=function(t,e){return this.data[t][e]},t.prototype.getRow=function(t){return this.data[t].slice()},t.prototype.getCol=function(t){for(var e=new Array(this.rows),n=0;n<this.rows;n++)e[n]=this.get(n,t);return e},t.prototype.set=function(t,e,n){this.data[t][e]=n},t.prototype.scaleColumns=function(e){for(var n=t.zeros(this.rows,this.cols),r=0;r<this.rows;r++)for(var i=0;i<this.cols;i++){var o=this.get(r,i)*e[i];n.set(r,i,o)}return n},t.prototype.scaleRows=function(e){for(var n=t.zeros(this.rows,this.cols),r=0;r<this.rows;r++)for(var i=0;i<this.cols;i++){var o=this.get(r,i)*e[r];n.set(r,i,o)}return n},t.prototype.multiplyVector=function(t){return this.data.map((function(e){return e.reduce((function(e,n,r){var i=t[r];return n&&i?e+n*i:e}),0)}))},t}();function i(t){return new Array(t).fill(0)}var o,s=function(){function t(){}return t.directImpactsOf=function(t,i){return e(this,void 0,void 0,(function(){var e;return n(this,(function(n){switch(n.label){case 0:return e=i instanceof r?i.getCol(0):i,[4,t.matrix("D")];case 1:return[2,n.sent().multiplyVector(e)]}}))}))},t.directRequirementsOf=function(t,i){return e(this,void 0,void 0,(function(){var e;return n(this,(function(n){switch(n.label){case 0:return e=i instanceof r?i.getCol(0):i,[4,t.matrix("A")];case 1:return[2,n.sent().multiplyVector(e)]}}))}))},t.directDownstreamsOf=function(t,o){return e(this,void 0,void 0,(function(){var e,s,a,c,u,l,h,f;return n(this,(function(n){switch(n.label){case 0:return e=o instanceof r?o.getCol(0):o,[4,t.matrix("A")];case 1:for(s=n.sent(),a=Math.min(s.cols,e.length),c=i(a),u=0,l=s.data;u<l.length;u++)for(h=l[u],f=0;f<a;f++)c[f]+=h[f]*e[f];return[2,c]}}))}))},t}();t.IndicatorGroup=void 0,(o=t.IndicatorGroup||(t.IndicatorGroup={})).IMPACT_POTENTIAL="Impact Potential",o.RESOURCE_USE="Resource Use",o.WASTE_GENERATED="Waste Generated",o.ECONOMIC_SOCIAL="Economic & Social",o.CHEMICAL_RELEASES="Chemical Releases";var a,c=function(){function t(t){if(this.map={},t)for(var e=0,n=t;e<n.length;e++){var r=n[e];this.map[r.sector]=r.amount}}return t.prototype.get=function(t){var e=this.map[t];return e||0},t}();t.Region=void 0,(a=t.Region||(t.Region={})).DOMESTIC="DOMESTIC",a.NON_DOMESTIC="NON_DOMESTIC",a.ALL="ALL";var u=function(){function t(t){this._map=t}return t.of=function(r){var i;return e(this,void 0,void 0,(function(){var e,o,s,a,c,u,l,h,f,d,p,v,m,g,y;return n(this,(function(n){switch(n.label){case 0:return[4,r.sectorCrosswalk()];case 1:return(e=n.sent())&&e.header&&0!==e.header.length&&e.mappings&&0!==e.mappings.length?[4,r.info()]:[2,new t({})];case 2:for(o=n.sent(),s=null===(i=null==o?void 0:o.sectorschema)||void 0===i?void 0:i.toLowerCase(),a=-1,c=-1,u=0;u<e.header.length&&!(a>=0&&c>=0);u++)"naics"!==(l=e.header[u].toLowerCase())?(s&&l==s||!c&&l.includes("bea")&&l.includes("detail"))&&(c=u):a=u;if(a<0||c<0)return[2,new t({})];for(h={},f=Math.max(a,c)+1,d=0,p=e.mappings;d<p.length;d++)(v=p[d]).length<f||(m=v[a].trim(),g=v[c].trim(),0!=m.length&&0!=g.length&&((y=h[m])?y.push(g):h[m]=[g]));return[2,new t(h)]}}))}))},t.prototype.toBea=function(t){if(!t)return[];for(var e={},n=0,r=t instanceof Array?t:[t];n<r.length;n++){var i=r[n],o=this._map[i];if(o)for(var s=0,a=o;s<a.length;s++){e[a[s]]=!0}}return Object.keys(e)},t}();var l=function(){function t(t){if(this._config=t,!t||!t.endpoint)throw new Error("invalid endpoint");var e=t.endpoint;e.endsWith("/")||(e+="/"),this._endpoint=e}return t.prototype.isJsonDump=function(){return!0===this._config.asJsonFiles},t.prototype.getModelInfos=function(){return e(this,void 0,void 0,(function(){return n(this,(function(t){return[2,this.getJson("models")]}))}))},t.prototype.getJson=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return e(this,void 0,void 0,(function(){var e,r;return n(this,(function(n){return e=this._target.apply(this,t),this._config.asJsonFiles&&(e.endsWith(".json")||(e+=".json")),r=this._request("GET",e),[2,new Promise((function(t,n){r.onload=function(){if(200===r.status)try{var i=JSON.parse(r.responseText);t(i)}catch(t){n("failed to parse response for: "+e+": "+t)}else n("request ".concat(e," failed: ").concat(r.statusText))},r.send()}))]}))}))},t.prototype.getText=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return e(this,void 0,void 0,(function(){var e,r;return n(this,(function(n){return e=this._target.apply(this,t),r=this._request("GET",e),[2,new Promise((function(t,n){r.onload=function(){if(200===r.status)try{t(r.responseText)}catch(t){n("failed to parse response for: "+e+": "+t)}else n("request ".concat(e," failed: ").concat(r.statusText))},r.send()}))]}))}))},t.prototype.post=function(t){for(var r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];return e(this,void 0,void 0,(function(){var e,i;return n(this,(function(n){return e=this._target.apply(this,r),i=this._request("POST",e),[2,new Promise((function(n,r){i.onload=function(){if(200===i.status)try{var t=JSON.parse(i.responseText);n(t)}catch(t){r("failed to parse response for POST "+e+": "+t)}else r("request POST ".concat(e," failed: ").concat(i.statusText))},i.send(JSON.stringify(t))}))]}))}))},t.prototype._target=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(!t)return this._endpoint;for(var n=this._endpoint,r=0,i=t;r<i.length;r++){var o=i[r];o&&(n.endsWith("/")||(n+="/"),n+=o)}return n},t.prototype._request=function(t,e){var n=new XMLHttpRequest;return n.open(t,e),n.setRequestHeader("Content-Type","application/json;charset=UTF-8"),this._config.apikey&&n.setRequestHeader("x-api-key",this._config.apikey),n},t}(),h=function(){function t(t,e){this.api=t,this.modelId=e,this._matrices={},this._demands={},this._totalResults={}}return t.prototype.id=function(){return this.modelId},t.prototype.info=function(){return e(this,void 0,void 0,(function(){var t,e,r,i;return n(this,(function(n){switch(n.label){case 0:return this._info?[3,2]:[4,this.api.getModelInfos()];case 1:for(t=n.sent(),e=0,r=t;e<r.length;e++)if((i=r[e]).id==this.id()){this._info=i;break}n.label=2;case 2:return[2,this._info]}}))}))},t.prototype.sectors=function(){return e(this,void 0,void 0,(function(){var t;return n(this,(function(e){switch(e.label){case 0:return this._sectors?[3,2]:(t=this,[4,this.api.getJson(this.modelId,"sectors")]);case 1:t._sectors=e.sent(),e.label=2;case 2:return[2,this._sectors||[]]}}))}))},t.prototype.isMultiRegional=function(){return e(this,void 0,void 0,(function(){var t,e,r,i,o;return n(this,(function(n){switch(n.label){case 0:return"boolean"==typeof this._isMultiRegional?[2,this._isMultiRegional]:[4,this.sectors()];case 1:for(t=n.sent(),r=0,i=t;r<i.length;r++)if((o=i[r]).location)if(e){if(e!==o.location)return this._isMultiRegional=!0,[2,!0]}else e=o.location;return this._isMultiRegional=!1,[2,!1]}}))}))},t.prototype.indicators=function(){return e(this,void 0,void 0,(function(){var t;return n(this,(function(e){switch(e.label){case 0:return this._indicators?[3,2]:(t=this,[4,this.api.getJson(this.modelId,"indicators")]);case 1:t._indicators=e.sent(),e.label=2;case 2:return[2,this._indicators||[]]}}))}))},t.prototype.demands=function(){return e(this,void 0,void 0,(function(){var t;return n(this,(function(e){switch(e.label){case 0:return this._demandInfos?[3,2]:(t=this,[4,this.api.getJson(this.modelId,"demands")]);case 1:t._demandInfos=e.sent(),e.label=2;case 2:return[2,this._demandInfos||[]]}}))}))},t.prototype.demand=function(t){return e(this,void 0,void 0,(function(){var e;return n(this,(function(n){switch(n.label){case 0:return(e=this._demands[t])?[2,e]:[4,this.api.getJson(this.modelId,"demands",t)];case 1:return e=n.sent(),this._demands[t]=e,[2,e]}}))}))},t.prototype.findDemand=function(t){return e(this,void 0,void 0,(function(){var e,r;return n(this,(function(n){switch(n.label){case 0:return[4,this.demands()];case 1:return e=n.sent(),[2,(r=e.find((function(e){return(!t.id||e.id===t.id)&&((!t.type||e.type===t.type)&&((!t.system||e.system===t.system)&&!(t.year&&e.year!==t.year)))})))?r.id:null]}}))}))},t.prototype.matrix=function(t){return e(this,void 0,void 0,(function(){var e,i;return n(this,(function(n){switch(n.label){case 0:return(e=this._matrices[t])?[2,e]:[4,this.api.getJson(this.modelId,"matrix",t)];case 1:return i=n.sent(),e=new r(i),this._matrices[t]=e,[2,e]}}))}))},t.prototype.column=function(t,r){return e(this,void 0,void 0,(function(){return n(this,(function(e){switch(e.label){case 0:return this.api.isJsonDump()?[4,this.matrix(t)]:[2,this.api.getJson(this.modelId,"matrix","".concat(t,"?col=").concat(r))];case 1:return[2,e.sent().getCol(r)]}}))}))},t.prototype.calculate=function(t){return e(this,void 0,void 0,(function(){var e,r,i,o,s,a,c,u,l;return n(this,(function(n){switch(n.label){case 0:return this.api.isJsonDump()?[4,this.indicators()]:[2,this.api.post(t,this.modelId,"calculate")];case 1:return e=n.sent(),[4,this.sectors()];case 2:return r=n.sent(),i=new Array(r.length).fill(10),o={},r.reduce((function(t,e){return t[e.id]=e.index,t}),o),t.demand.forEach((function(t){var e=o[t.sector];(0===e||e)&&(i[e]=t.amount)})),[4,this.matrix("N")];case 3:switch(s=n.sent(),t.perspective){case"direct":return[3,4];case"intermediate":return[3,7];case"final":return[3,9]}return[3,10];case 4:case 7:return[4,this.matrix("L")];case 5:return c=n.sent(),l=c.multiplyVector(i),[4,this.matrix("D")];case 6:return u=n.sent(),a=u.scaleColumns(l).data,[3,11];case 8:return c=n.sent(),l=c.multiplyVector(i),a=s.scaleColumns(l).data,[3,11];case 9:return a=s.scaleColumns(i).data,[3,11];case 10:throw new Error("unknown perspective ".concat(t.perspective));case 11:return[2,{data:a,indicators:e.map((function(t){return t.code})),sectors:r.map((function(t){return t.id})),totals:s.multiplyVector(i)}]}}))}))},t.prototype.getTotalResults=function(t){return e(this,void 0,void 0,(function(){var e,r,i,o;return n(this,(function(n){switch(n.label){case 0:return Array.isArray(t)?(e={perspective:"final",demand:t},[4,this.calculate(e)]):[3,2];case 1:return[2,n.sent().totals];case 2:return(r=this._totalResults[t])&&r.length>0?[2,r]:[4,this.demand(t)];case 3:return i=n.sent(),[4,this.calculate({perspective:"final",demand:i})];case 4:return(o=n.sent())?(this._totalResults[t]=o.totals,[2,o.totals]):[2,[]]}}))}))},t.prototype.singleRegionSectors=function(){return e(this,void 0,void 0,(function(){var t,e,r,i,o,s,a,c;return n(this,(function(n){switch(n.label){case 0:return this._sectorAggregation?[2,this._sectorAggregation]:[4,this.sectors()];case 1:return t=n.sent(),[4,this.isMultiRegional()];case 2:if(!n.sent())return e=t.reduce((function(t,e){return t[e.code]=e.index,t}),{}),this._sectorAggregation={index:e,sectors:t},[2,this._sectorAggregation];for(r=[],i={},o=0,s=0,a=t;s<a.length;s++)c=a[s],void 0===i[c.code]&&(i[c.code]=o,r[o]={code:c.code,id:c.code,index:o,name:c.name,description:c.description},o++);return this._sectorAggregation={index:i,sectors:r},[2,this._sectorAggregation]}}))}))},t.prototype.sectorCrosswalk=function(){return e(this,void 0,void 0,(function(){var t,e,r,i,o,s;return n(this,(function(n){switch(n.label){case 0:return this._sectorCrosswalk?[2,this._sectorCrosswalk]:[4,this.api.getText("sectorcrosswalk.csv")];case 1:if(t=n.sent(),0==(e=t.split(/\r?\n/)).length)return[2,{header:[],mappings:[]}];for(r=function(t){var e=t.trim(),n=[];if(0==e.length)return n;for(var r=!1,i="",o=0;o<e.length;o++){var s=e.charAt(o);r?'"'==s?r=!1:i+=s:'"'!=s?","!=s?i+=s:(n.push(i),i=""):r=!0}return n.push(i),n},i=r(e[0]),o=[],s=1;s<e.length;s++)o.push(r(e[s]));return this._sectorCrosswalk={header:i,mappings:o},[2,this._sectorCrosswalk]}}))}))},t}(),f=function(){function t(t,e,n){this.model=t,this.sector=e,this.normalizationTotals=n}return t.of=function(r,i,o){return e(this,void 0,void 0,(function(){var e,s;return n(this,(function(n){switch(n.label){case 0:return[4,r.demand(o)];case 1:return e=n.sent(),[4,r.calculate({perspective:"direct",demand:e})];case 2:return s=n.sent(),[2,new t(r,i,s.totals)]}}))}))},t.prototype.getEnvironmentalProfile=function(t){return void 0===t&&(t=!1),e(this,void 0,void 0,(function(){var e,r;return n(this,(function(n){switch(n.label){case 0:return[4,t?this.model.column("D",this.sector.index):this.model.column("N",this.sector.index)];case 1:for(e=n.sent(),r=0;r<e.length;r++)e[r]/=this.normalizationTotals[r];return[2,e]}}))}))},t.prototype.getImpactsByScope=function(){return e(this,void 0,void 0,(function(){var t,e,r,o,s,a,c;return n(this,(function(n){switch(n.label){case 0:return[4,this.model.column("N",this.sector.index)];case 1:return t=n.sent(),[4,this.model.column("D",this.sector.index)];case 2:return e=n.sent(),[4,this.model.column("N_d",this.sector.index)];case 3:for(r=n.sent(),o=i(t.length),s=i(t.length),a=i(t.length),c=0;c<t.length;c++)o[c]=t[c]-e[c],s[c]=r[c]-e[c],a[c]=o[c]-s[c];return[2,{direct:e,total:t,upstreamTotal:o,upstreamDomestic:s,upstreamNonDomestic:a}]}}))}))},t}();t.CommodityVector=s,t.DemandVector=c,t.Matrix=r,t.NaicsMap=u,t.SectorAnalysis=f,t.WebApi=l,t.WebModel=h,t.max=function(t){return t&&0!==t.length?t.reduce((function(t,e){return Math.max(t,e)})):0},t.modelOf=function(t){var e=new l(t);return new h(e,t.model)},t.ones=function(t){return new Array(t).fill(1)},t.zeros=i,Object.defineProperty(t,"__esModule",{value:!0})}));