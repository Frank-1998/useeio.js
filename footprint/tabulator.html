<!DOCTYPE html>
<html>

<head>
<meta charset='utf-8'>
<title>Tabulator Example</title>
<link rel="shortcut icon" href="data:image/x-icon;," type="image/x-icon">
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://unpkg.com/tabulator-tables@5.2.7/dist/css/tabulator.min.css" rel="stylesheet">
<script type="text/javascript" src="https://unpkg.com/tabulator-tables@5.2.7/dist/js/tabulator.min.js"></script>

<script src="../dist/useeio.min.js"></script>

<script type="text/javascript" src="/localsite/js/localsite.js?showheader=true&showsearch=true"></script>

<script src="./config.js"></script>
<script>

async function main() {
  // compute the table data
  const q = await model.matrix('q'); // Commodity
  const sectors = await model.sectors();
  const indicator = (await model.indicators())
    .filter(i => i.code === 'JOBS')[0];
  const impacts = await model.matrix('D'); // Indicator_Sector (like industries)

  const tableData = sectors.map(sector => {
    const output = q.get(sector.index, 0);
    const jobs = output * impacts.get(indicator.index, sector.index);
    return {
      ...sector,
      output: Math.round(output),
      jobs: Math.round(jobs)
    };
  });
  
  //console.log(tableData);

  tableData.forEach(item => { // For each object in array
    item.jobsEasy = formatCell(item.jobs);
    item.outputEasy = "$" + formatCell(item.output);
  }); 

  var table = new Tabulator("#table", {
    height: 500,
    data: tableData,
    layout: "fitColumns",
    columns: [
      { title: "Commodity", field: "name", width: "35%" },
      { title: "Location", field: "location" },
      { title: "Output", field: "output", visibleX: false }, // Total commodity output
      { title: "Output", field: "outputEasy", sorter: function(a, b, aRow, bRow, column, dir, sorterParams) {
              let aOutput = aRow.getData().output;
              let bOutput = bRow.getData().output;
              return aOutput - bOutput; // Sort based on the numeric `output` values
          }
      },

      { title: "Jobs", field: "jobs", visibleX: false }, // Hidden column for sorting
      {
          title: "Jobs", field: "jobsEasy", sorter: function(a, b, aRow, bRow, column, dir, sorterParams) {
              // a, b: the display values being compared (jobsEasy)
              // aRow, bRow: the row components for the values being compared
              // Access the hidden `jobs` values for sorting
              let aJobs = aRow.getData().jobs;
              let bJobs = bRow.getData().jobs;
              return aJobs - bJobs; // Sort based on the numeric `jobs` values
          }
      }
    ],
  });
}
main();
</script>

</head>

<body>

<div class="contentpadding">
  We also display from state .csv files <a href="http://localhost:8887/data-pipeline/research/economy/">pre-generated using python</a><br><br>

  <div id="table"></div>
</div>


</body>
</html>