<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>Open Footprint - EEIO Labels</title>
  <link rel="shortcut icon" href="data:image/x-icon;," type="image/x-icon">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script type="text/javascript" src="/localsite/js/localsite.js?showheader=true"></script>
  <link rel="stylesheet" href="/localsite/css/base.css" id="/localsite/css/base.css" />
  <!--
  <link rel="stylesheet" href="../node_modules/mocha/mocha.css" />
  -->
</head>

<body>

  <!-- Try uncommenting after doing install for node-modules 
  Also uncomment mocha.css above.
  -->
  <!--
  <div id="mocha"></div>
  <script src="../node_modules/mocha/mocha.js"></script>
  <script src="../node_modules/chai/chai.js"></script>
  <script src="../dist/useeio.js"></script>

  <script class="mocha-init">
    var assert = chai.assert;
    var expect = chai.expect;
    var webApi = new useeio.WebApi({
      endpoint: 'http://localhost:8080/api',
      asJsonFiles: true,
    });
    mocha.setup('bdd');
  </script>

<script src="model-requests.js"></script>
<script src="matrix-requests.js"></script>

  <script class="mocha-exec">
    mocha.run();
  </script>
  -->
<script>
loadMarkdown("schema.md", "schemaDiv", "_parent");
loadText("../../OpenFootprint/impacts/exiobase/US-source/create-database.yaml", "yamlDiv", "_parent");
loadMarkdown("README.md", "readmeDiv", "_parent");
</script>

<style>
  a {
    text-decoration:none;
    color: #0366d6;
  }
  a:hover {
    text-decoration: underline;
  }

  td {
    border: 1px solid #ccc;
    padding:  5px;
  }
  th,td {
    align: left;
  }
  #floatRightID {
    min-width: 220px;
    border-left: 1px solid #ccc;
    padding-left: 30px;
  }
  @media (max-width: 800px) {
    #floatRightID {
      border-left: 0px;
      padding: 30px 0;
      border-top: 1px solid #ccc;
      border-bottom: 1px solid #ccc;
    }
  }
</style>


<div class="content contentpadding">

<a href="/OpenFootprint">Open Data Panels</a><br>

<div id="floatRightID" class="floatRight">
  <b>GitHub Repos</b><br>
  <a href="https://github.com/modelearth/useeio.js">useeio.js</a><br>
  <a href="https://github.com/modelearth/useeio-widgets">useeio-widgets</a><br>
  <a href="https://github.com/modelearth/localsite">localsite repo</a><br>
  <a href="https://github.com/modelearth/io">io repo</a><br><br>
  <!-- no longer available, use other API
<a href="https://smmtool.app.cloud.gov/">API</a><br><br>
  -->

  <b>Chart Starters</b><br>

  <a href="../../OpenFootprint/trade/">Trade Flow Map</a><br>
  <a href="../charts/d3/chord-diagram/">Chord (D3)</a><br><!-- https://nivo.rocks/chord/ -->
  <a href="../charts/echarts/sankey-nodeAlign-left.html">Sankey (eCharts)</a><br><br>

  <b>Label Samples</b><br>
  <a href="/io/template/">Footprint Builder</a><br>
  <a href="/data-commons/docs/food/">Food Nutrition Label</a>
</div>

<h1>International Trade Flow</h1>
<b>US Bureau of Economic Analysis (BEA) + Exiobase International Trade Data</b><br>
Our SQL Team is sending data to <a href="/OpenFootprint/prep/sql/supabase/">Supabase</a> and <a href="/OpenFootprint/prep/sql/duckdb/">DuckDB</a> for Countries, States and the Earth.<br><br>

We first generate CSV files by running <a href="https://github.com/ModelEarth/USEEIO/tree/import_factors/import_factors_exio">generate_import_factors.py</a> to combines US BEA and <a href="https://exiobase.eu">EXIOBASE</a> data emissions factors for annual trade data. Exiobase provides the equivalent to <a href="https://github.com/USEPA/useeior/blob/master/format_specs/Model.md">M, N, and x</a> which is used in the <a href="/io/about/">USEEIO models</a> for import emissions factors. Exiobase also provides gross trade data which has no equivalent in USEEIO.<br><br>

<b>Pulling data into state SQL databases</b><br>
For easy comprehension by elementary school students<br>
<a href="/OpenFootprint/prep/sql/supabase">Supabase Data Loader notes</a><br>
<a href="/OpenFootprint/prep/">DuckDB notes (and older Supabase notes)</a><br>
<a href="/requests/products/">Harmonized System (HS) codes</a> - <a href="https://colab.research.google.com/drive/1etpn1no8JgeUxwLr_5dBFEbt8sq5wd4v?usp=sharing">Our HS CoLab</a><br>
<a href="/OpenFootprint/impacts/">Sample of JavaScript joining DuckDB Parquet tables</a><br>
<a href="https://model.earth/storm/impact/process.html">SQL Documentation Sample - Storm Tweet Data</a><br><br>

<b>Python to pull CSV files into SQL</b><br>
<a href="https://colab.research.google.com/drive/1qWgO_UjeoYYB3ZSzT3QdXSfVZb7j09_S?usp=sharing">Generate Supabase Exiobase (Colab)</a> - <a href="https://github.com/ModelEarth/OpenFootprint/tree/main/impacts/exiobase/US-source">Bkup</a><br>
<a href="https://colab.research.google.com/drive/1Wm9Bvi9pC66xNtxKHfaJEeIYuXKpb1TA?usp=sharing">Generate DuckDB Exiobase (CoLab) - <a href="https://github.com/ModelEarth/OpenFootprint/tree/main/impacts/exiobase/US-source">Bkup</a><br><br>

<b>State Models - US Environmentally Extended Input-Output</b> (US EEIO)<br>
<a href="/io/about/">USEEIO state models</a> - Upcoming SQL tables<br>
<a href="https://colab.research.google.com/drive/1CYKNTnLiZ_PbP5WS_dMVtYyYDIAFwzq8?usp=sharing" target="useeio_colab">Generate Supabase USEEIO (CoLab)</a> - Upcoming python to migrate from matrix to SQL tables<br>
<a href="/data-pipeline/research/economy/">Commodities for US and All 50 States (uses python to pull from matrix files)</a> - <a href="https://github.com/ModelEarth/OpenFootprint/tree/main/impacts/2020">2020 Data Source</a><br><br>




<div style="clear:both"></div>

<style>
#schemaDiv strong {
  font-size: 16px;
}
.yamlPre {
  background-color: #eee;
  padding: 20px;
  overflow-y: scroll;
}
.dark .yamlPre {
  background-color: #222;
}
</style>

<div id="schemaDiv"></div>

<h3>YAML used by SQL insert</h3>

The following YAML for the SQL insert resides at <a href="https://github.com/ModelEarth/OpenFootprint/blob/main/impacts/exiobase/US-source/create-database.yaml">OpenFootprint/impacts/exibase/US-source/create-database.yaml</a><br>
Created with python from <a href="https://chatgpt.com/share/3a89cc73-c839-4592-bc6e-e82a6a8e400b">From ChatGPT</a> which resides here in a hidden comment.<br>

<!--
import yaml
import pandas as pd
import sqlalchemy
from sqlalchemy import create_engine, Table, MetaData

# Load the YAML file
with open('create-database.yaml', 'r') as file:
    config = yaml.safe_load(file)

# Create SQL Alchemy Engine
engine = create_engine('sqlite:///example.db')
metadata = MetaData()

# Function to convert column names to CamelCase without underscores
def to_camel_case(snake_str):
    components = snake_str.split('_')
    return components[0].capitalize() + ''.join(x.title() for x in components[1:])

# Process each table in the YAML configuration
for table_name, table_config in config.items():
    csv_file = table_config['source']
    df = pd.read_csv(csv_file)

    columns_map = table_config.get('columns', {})
    omit_columns = table_config.get('omit', [])

    # Drop omitted columns
    df.drop(columns=omit_columns, errors='ignore', inplace=True)

    # Rename columns as per the YAML configuration
    df.rename(columns=columns_map, inplace=True)

    # Generate new column names for remaining columns
    new_columns = {}
    for col in df.columns:
        if col not in columns_map.values():
            new_columns[col] = to_camel_case(col)
    df.rename(columns=new_columns, inplace=True)

    # Exclude 'Year' column if not explicitly included in columns_map
    if 'Year' not in columns_map.values() and 'Year' in df.columns:
        df.drop(columns=['Year'], inplace=True)

    # Append "US" to the table name
    table_name = table_name + "US"

    # Insert/Update the data into the database
    if engine.dialect.has_table(engine, table_name):
        # Update existing table
        temp_table_name = table_name + "_temp"
        df.to_sql(temp_table_name, engine, if_exists='replace', index=False)
        with engine.connect() as conn:
            conn.execute(f"""
                INSERT OR REPLACE INTO {table_name}
                SELECT * FROM {temp_table_name}
            """)
            conn.execute(f"DROP TABLE {temp_table_name}")
    else:
        # Create and insert new table
        df.to_sql(table_name, engine, if_exists='replace', index=False)
-->

<pre class="yamlPre">
<div id="yamlDiv"></div>
</pre>

<div id="readmeDiv"></div>

<h1>useeio.js review files</h1>

You can view the frontend widgets at <a href="https://model.earth/io/charts">model.earth/io/charts</a><br>
The IO charts use the <a href="../dist/useeio.min.js">dist/useeio.min.js file</a> generated by <a href="../">running the build</a><br><br>

<b>Currently Broken since EPI API key now required</b><br>
TO DO: Convert these to toggle to json output from API.<br><br>

<a href="calculation.html">Impact Calculation</a><br>
<a href="tabulator.html">Commodities</a></a><br>
<a href="commodity_vector.html">Commodity Vector</a><br>
<a href="demands.html">Demands</a><br>
<a href="model_info.html">Model Info</a><br>
<a href="naics_map.html">Naics Map</a><br>
<a href="sector_crosswalk.html">Sector Crosswalk</a><br>
<a href="sector_profile.html">Sector Profile</a><br>
<a href="sector_purchase_impacts.html">Sector Purchase Impacts</a><br>
<a href="sector_scopes.html">Sector Scopes</a><br>
<a href="sector_supply_impacts.html">Sector Supply Impacts</a><br>
<a href="matrix-requests.js">Matrix Requests (js)</a><br>
<a href="model-requests.js">Model Requests (js)</a><br>
<br>

Some of the above samples only send json to the console.log, so view with your browser's inspector.<br><br>

TO DO: Use the function formatCell() in config.js to make numbers simple in the pages above (42.2 Billion, etc.). The config.js file is included in all the pages above.<br><br>

TO DO: Create a toggle to move between the simple number display, full numbers and scietific notation. Place in the upper right above a <a href="tabulator.html">tabulator.html</a> on all the pages above and hide the two extra columns.<br><br>

TO DO: Use <a href="https://github.com/ModelEarth/USEEIO/tree/import_factors/import_factors_exio">generate_import_factors.py</a> to run 2012 to 2016. Try with 2017 schema, and compare to 2012 schema to see if the older data needs it for the sector/commodity names.<br><br> 

TO DO: Pull SQL into our <a href="../../OpenFootprint/trade/">trade flow map</a>. Here's another <a href="https://github.com/ModelEarth/trademapper-js">trade flow map</a> we can expand. It's visible at <a href="https://trademapper.co.uk">trademapper.co.uk</a> with sample data in their <a href="https://github.com/trademapper/trademapper-js/wiki/How-to-use-trademapper">GitHub Wiki</a>.


</div>

</body>
</html>